---
title: "Good Malware"
date: 2021-10-23T10:22:10+07:00
tags: ["evasive","defenses down","good is bad"]
images: [
    https://raw.githubusercontent.com/ByridianBlack/BlogImages/main/good/image-000.png,
]
toc: true
---

# Good.exe
Sha256: 90d3580e187b631a9150bbb4a640b84c6fa990437febdc42f687cc7b3ce1deac
Md5 : b034e2a7cd76b757b7c62ce514b378b4
Sha1 : 27d15f36cb5e3338a19a7f6441ece58439f830f2

## Analysis
Initially this piece of malware was UPX packed as shown in the following Figure

### Figure 1
![image](https://raw.githubusercontent.com/ByridianBlack/BlogImages/main/good/image-000.png)

Using UPX tool to unpack the piece of malware. It is less packed because further analysis of the entropy of the PE executable reveals that it is indeed packed further. This can be found in Figure 2.

### Figure 2
![image](https://raw.githubusercontent.com/ByridianBlack/BlogImages/main/good/image-001.png)

The packed sample remained a high priority for if there are two packers being used something clearly wants to be hidden. Unfortunately the disassembled code was so obstructacted it would have taken so long to analyze it would have not been worth statically analyzing. There was no sign of a Virtual packer being used but it appeared to be. Maybe a non commercial one, something developed in house was being used. Rather my approach was to let automation do its job. Using the service unpac.me Unpac.me was able to extract a PE which will be called unpacked_good.bin for now.

1. Sha256: 3ebca4d21c484f97a0b607693e36359b7ddb8eefa67ea29364629eb5b40cc7f4
2. Sha1 : 444903bcc71087ba7c5c2d18d9cd5532
3. Md5 : 3593d356202aff91465f797a42ee8a071e507f3c

## Important Imports

Unpacked_good.bin is much more readable and right away I see the following important functions:
1. RegOpenKeyExW
2. RegQueryValueExW
3. RegSetValueExW


The registry keys being set here allow for the malware to evade detection and persistence. They are using the
HKEY_LOCAL_MACHINE & HKEY_CURRENT_USER paths, along with the path Software\\Microsoft\\Windows\\CurrentVersion\\Run\\ and placing in the file mwcfgmr32.exe allowing for autorun when restarting the machine. Throughout this analysis a copy of this file was not obtained even when reports showed it was written too. The effects had the same functionality of the unpacked PE executable so I believe it was nothing more than a copy.

## Evasive Techniques
Initially the Firewall Policy was changed, disabling it.

### Figure 3
![image](https://raw.githubusercontent.com/ByridianBlack/BlogImages/main/good/image-002.png)

### Figure 4
![image](https://raw.githubusercontent.com/ByridianBlack/BlogImages/main/good/image-003.png)

Windows Defender was being manipulated, disabling key features such as AntiSpyware, Real-Time-Protection, ScanOnRealtimeEnable, OnAccessProtection and BehaviorMonitor. Again this was an evasive step taken by the malware as these happen in the background and can seriously affect a computer's defenses.

HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Security Center\ Is being modified for the following entries:

### Figure 5
![image](https://raw.githubusercontent.com/ByridianBlack/BlogImages/main/good/image-004.png)

Lastly this malare is disabling system restore

### Figure 6
![image](https://raw.githubusercontent.com/ByridianBlack/BlogImages/main/good/image-005.png)

This malware uses a created mutex to determine if another instance of this malware is being run already. If it is, the process exists.

Mutex: 495040303040

### Figure 7
![image](https://raw.githubusercontent.com/ByridianBlack/BlogImages/main/good/image-006.png)

Now from here is what can be believed as the true functionality of the malware which is a dropper for other malware. Using a set of URLs and file names the malware is trying to download files from these urls.

### Figure 8
![image](https://raw.githubusercontent.com/ByridianBlack/BlogImages/main/good/image-007.png)

Of these 13 URLs only 3 of them could be pinged too which were the following:
1. http://efhoahegue.ru/s/ - 162.217.98.146
2. http://afhoahegue.ru/s/ - 199.21.76.77
3. http://xfhoahegue.ru/s/ - 63.251.106.25

Of these urls the malware wasn’t able to download any of them. Doing this manually though with wget it there was a redirection stating this page was malicious. Bypassing them then determined that all of these files on these pages have been taken offline. Using the WayBackMachine showed that these pages have never been archived so maybe that means that this page was only up for a short period of time.

## Further Evasive techniques

While no file could be downloaded this malware showed that it did not want to be seen. This was done by deleting the Zone.Identiefer after every file Download.

### Figure 9
![image](https://raw.githubusercontent.com/ByridianBlack/BlogImages/main/good/image-008.png)

The Zone.Identifier is a file created after a file has been downloaded allowing for forensic information to be extracted from this. This file is actually an alternative data. This can make it harder for analysts to extract information about what is being downloaded. These executables downloaded were going to then be executed. Since these files cannot be downloaded I have to just leave it at this as being a dropper.

Going back to the original sample there is evidence to support that it is a keylogger. In the resource section there are key mappings but running it found no keylog files to support this claim.

### Figure 10
![image](https://raw.githubusercontent.com/ByridianBlack/BlogImages/main/good/image-009.png)

## Conclusion

This was an evasive malware dropper that could be extremely damaging and persistent especially if given the write permissions. Has the power to disable a computer's defenses and then drop files and execute more malware on a victim’s computer.

## Host Based & Network Indicators
1. User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.9; rv:25.0) Gecko/20100101 Firefox/25.0
2. This malware changed timestamps so they should not be trusted


### Figure 11
![image](https://raw.githubusercontent.com/ByridianBlack/BlogImages/main/good/image-010.png)
3. URLS contacted and IPS

Tools Used:
1. PE Explorer
2. Detect It Easy
3. https://unpac.me
4. IDA Pro
5. Procmon
6. Process Explorer
7. Wireshark
8. Virtual Box
Environment Used
1. Windows XP

Further Readings
1. https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-fscc/6e3f7352-d11c-4d76-8c39-2516a9df36e8
2. https://www.deepinstinct.com/2018/06/12/the-abuse-of-alternate-data-stream-hasnt-disappeared